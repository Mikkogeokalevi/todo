<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geok√§tk√∂reissun Suunnittelija</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="sisalto-laatikko">
        <div id="speed-display">-- km/h</div>

        <div class="teksti-alue">
            <div class="logo-container">
                <img src="https://img.geocaching.com:443/84454fa6-e23a-4aad-a8a4-612b77f23abe.png" alt="Oma logo" class="logo" />
                <div>
                    <h1 class="paaotsikko">‚Äî MK Reissuapuri ‚Äî</h1>
                    <h2 id="listNameDisplay" class="list-name-display"></h2>
                </div>
            </div>

            <div class="container">
                <div class="profile-controls">
                    <button id="toggleTrackingBtn">üõ∞Ô∏è Aloita seuranta</button>
                </div>

                <div id="location-status-display">
                    <p>Aloita seuranta n√§hd√§ksesi sijaintisi...</p>
                </div>

                <div id="map"></div>

                <div id="activeMunicipalityContainer" class="hidden">
                </div>
                
                <div id="settingsAndHelpContainer" class="settings-and-help-wrapper">
                    <div class="pgc-settings-container">
                        <details>
                            <summary>Asetukset</summary>
                            <div class="pgc-input-wrapper">
                                <label for="pgcProfileName">Project-GC nimi:</label>
                                <input type="text" id="pgcProfileName" placeholder="Oma k√§tk√∂ilynimesi...">
                                <div class="pgc-link-container">
                                    <a id="pgcMapCountiesLink" href="#" target="_blank" rel="noopener noreferrer">Avaa kuntakartta Project-GC:ss√§</a>
                                </div>
                                <hr class="custom-hr" style="margin: 10px 0;">
                                <label>Lokittajat:</label>
                                <ul id="loggerList"></ul>
                                <div class="add-logger-controls">
                                    <input type="text" id="newLoggerInput" placeholder="Uuden lokittajan nimi...">
                                    <button id="addLoggerBtn">+</button>
                                </div>
                            </div>
                        </details>
                    </div>

                    <div class="help-container">
                        <details>
                            <summary>Ohjeet</summary>
                            <div class="help-content">
                                <h4>1. Reissulistan rakentaminen</h4>
                                <p>Voit lis√§t√§ kuntia ja k√§tk√∂j√§ reissulistallesi usealla eri tavalla. N√§m√§ toiminnot l√∂ytyv√§t <strong>Reissulista</strong>-v√§lilehden "Lis√§√§ & Hallinnoi" -osiosta.</p>
                                <ul>
                                    <li><strong>Lis√§√§ kunta listana:</strong> Kirjoita tai liit√§ kuntien nimi√§ pilkulla tai rivinvaihdolla eroteltuna. Sovellus hakee kuntien sijainnit ja lis√§√§ ne listaan.</li>
                                    <li><strong>Tuo GPX-tiedosto:</strong> Tuo k√§tk√∂j√§ suoraan .gpx-tiedostosta, jonka olet ladannut esimerkiksi geocaching.com-sivuston Pocket Query -toiminnolla.</li>
                                    <li><strong>Lis√§√§ k√§tk√∂ PGC-datalla:</strong> Kopioi Project-GC.com-sivustolta k√§tk√∂tietoja (kolmen rivin lohkoja) ja liit√§ ne tekstikentt√§√§n. Sovellus selvitt√§√§ automaattisesti k√§tk√∂jen kunnat ja lis√§√§ ne reissulistallesi.<br>
                                        <em>Esimerkki kopioitavasta datasta:</em>
                                        <pre><code>GC9P3EP - Machomies heiluttaa - 4 FP (4%)
Multi-cache / Micro / 2.0 / 2.0
N 63¬∞ 00.033 E 022¬∞ 10.393</code></pre>
                                    </li>
                                    <li><strong>Lis√§√§ k√§tk√∂ manuaalisesti:</strong> Voit lis√§t√§ yksitt√§isen k√§tk√∂n suoraan haluamasi kunnan alle sy√∂tt√§m√§ll√§ k√§tk√∂n nimen tai GC-koodin.</li>
                                </ul>

                                <h4>2. Reissun aikana: Seuranta ja kartta</h4>
                                <ul>
                                    <li><strong>Paikannus:</strong> Paina "üõ∞Ô∏è Aloita seuranta" -nappia. Sijaintisi n√§kyy kartalla sinisen√§ pisteen√§, ja nopeutesi p√§ivittyy oikeaan yl√§kulmaan.</li>
                                    <li><strong>H√§lytykset:</strong> Sovellus antaa ilmoituksen ja √§√§nimerkin, kun l√§hestyt reissulistallasi olevaa k√§tk√∂√§ (1,5 km ja 200 m et√§isyydell√§).</li>
                                    <li><strong>Aktiivinen kunta:</strong> Kun saavut kunnan alueelle, joka on listallasi, kunta korostuu reissulistalla keltaisella ja sen tiedot ilmestyv√§t kartan alle. Lis√§ksi kuulet √§√§nimerkin.</li>
                                    <li><strong>Kuntien rajat:</strong> Kun paikannus on p√§√§ll√§, nykyisen kuntasi rajat piirret√§√§n kartalle. Kun paikannus ei ole p√§√§ll√§, voit klikata mit√§ tahansa kuntaa kartalla n√§hd√§ksesi sen rajat.</li>
                                </ul>

                                <h4>3. K√§tk√∂jen ja kuntien hallinta</h4>
                                <ul>
                                    <li><strong>Kuntien j√§rjestys:</strong> Voit muuttaa kuntien j√§rjestyst√§ raahaamalla niit√§ listalla.</li>
                                    <li><strong>K√§tk√∂n kuittaus:</strong> Kun l√∂yd√§t k√§tk√∂n, rastita sen edess√§ oleva ruutu <code>[x]</code>. K√§tk√∂ siirtyy <strong>Loki</strong>-v√§lilehdelle ja saa l√∂yt√∂hetken aikaleiman.</li>
                                    <li><strong>Kunnan kuittaus:</strong> Voit merkit√§ koko kunnan "tehdyksi" rastittamalla sen nimen vieress√§ olevan ruudun <code>[x]</code>. T√§m√§ muuttaa kunnan taustan vihre√§ksi.</li>
                                    <li><strong>Muokkaus ja poisto:</strong> Sek√§ kuntien ett√§ k√§tk√∂jen tietoja voi muokata kyn√§n kuvakkeesta (‚úèÔ∏è) ja ne voi poistaa roskakorin kuvakkeesta (üóëÔ∏è).</li>
                                </ul>

                                <h4>4. Loki-v√§lilehti</h4>
                                <ul>
                                    <li><strong>L√∂ydetyt k√§tk√∂t:</strong> T√§√§ll√§ n√§et kaikki reissulistalta kuitatut sek√§ suoraan lokiin lis√§tyt k√§tk√∂t.</li>
                                    <li><strong>J√§rjestys:</strong> Voit j√§rjest√§√§ lokin√§kym√§n joko aikaleiman tai kunnan nimen mukaan.</li>
                                    <li><strong>Lokittajat:</strong> Voit merkit√§, ketk√§ olivat mukana l√∂yd√∂ll√§. Muokkaa lokittajien nimi√§ <strong>Asetukset</strong>-valikosta.</li>
                                </ul>

                                <h4>5. Asetukset</h4>
                                <ul>
                                    <li><strong>Project-GC nimi:</strong> Sy√∂tt√§m√§ll√§ t√§h√§n oman k√§tk√∂ilynimesi aktivoit k√§tev√§t linkit (üó∫Ô∏è) jokaisen kunnan ja karttaklikkauksen yhteyteen. Linkit avaavat kyseisen kunnan kartan suoraan sinun profiilillasi Project-GC-sivustolla.</li>
                                    <li><strong>Lokittajat:</strong> T√§√§ll√§ voit lis√§t√§ ja poistaa reissussa mukana olevien henkil√∂iden nimi√§. N√§m√§ nimet ilmestyv√§t valintaruutuina jokaisen k√§tk√∂n kohdalle <strong>Loki</strong>-v√§lilehdell√§, jolloin voit helposti merkit√§, ketk√§ kirjasivat l√∂yd√∂n.</li>
                                </ul>
                            </div>
                        </details>
                    </div>
                </div>
                
                <hr class="custom-hr">

                <div class="view-toggles">
                    <button id="showTripListBtn" class="view-toggle-btn active">Reissulista</button>
                    <button id="showFoundLogBtn" class="view-toggle-btn">Loki</button>
                </div>

                <div id="tripListView">
                    <details class="management-details">
                        <summary>Lis√§√§ & Hallinnoi</summary>
                        <div class="details-content">
                            <button id="toggleBulkAddBtn" class="toggle-button">Lis√§√§ kunnat listana</button>
                            <div id="bulkAddContainer" class="bulk-add hidden">
                                <h3>Lis√§√§ kunnat listana</h3>
                                <textarea id="bulkAddMunicipalities" rows="4" placeholder="Liit√§ t√§h√§n kunnat pilkulla tai rivinvaihdolla eroteltuna..."></textarea>
                                <button id="bulkAddBtn">Lis√§√§ listasta</button>
                            </div>
                            
                            <button id="togglePgcAddBtn" class="toggle-button">Lis√§√§ PGC-datalla</button>
                            <div id="globalPgcAddContainer" class="bulk-add hidden">
                                <h3>Lis√§√§ k√§tk√∂ PGC-datalla (automaattinen kunnan haku)</h3>
                                <textarea id="globalPgcPasteArea" rows="4" placeholder="Liit√§ PGC:n k√§tk√∂tiedot t√§h√§n..."></textarea>
                                <button id="globalAddFromPgcBtn">Lis√§√§ ja paikanna</button>
                            </div>

                            <button id="toggleGpxAddBtn" class="toggle-button">Tuo GPX-tiedosto</button>
                            <div id="gpxAddContainer" class="bulk-add hidden">
                                <h3>Tuo k√§tk√∂t .gpx-tiedostosta</h3>
                                <input type="file" id="gpxFileInput" accept=".gpx" style="display: none;">
                                <button id="selectGpxFileBtn">Valitse tiedosto</button>
                                <p id="gpxFileName" style="text-align: center; margin-top: 10px;"></p>
                                <button id="importGpxBtn" class="hidden">Tuo k√§tk√∂t</button>
                            </div>
                        </div>
                    </details>
                    
                    <div id="tripIndexContainer" class="hidden">
                        <details class="management-details">
                            <summary>Omat Reissulistat</summary>
                            <div class="details-content">
                                <ul id="tripIndexList"></ul>
                            </div>
                        </details>
                        <hr class="custom-hr">
                    </div>
                    <h2 class="alaotsikko">L√∂ydett√§v√§t kunnat ja k√§tk√∂t</h2>
                    <ul id="municipalityList"></ul>
                </div>

                <div id="foundLogView" class="hidden">
                    <details class="management-details">
                        <summary>Lis√§√§ lokiin</summary>
                        <div class="details-content">
                            <div id="logPgcAddContainer" class="bulk-add">
                                <h3>Lis√§√§ l√∂ydetyt PGC-datalla</h3>
                                <textarea id="logPgcPasteArea" rows="4" placeholder="Liit√§ l√∂ydettyjen k√§tk√∂jen PGC-tiedot t√§h√§n..."></textarea>
                                <button id="logAddFromPgcBtn">Lis√§√§ l√∂ydetyt lokiin</button>
                            </div>

                            <div class="direct-add-cache">
                                <input type="text" id="directAddInput" placeholder="Yksitt√§inen lis√§ys: liit√§ k√§tk√∂n URL (coord.info/GC...)">
                                <button id="directAddBtn">Lis√§√§ lokiin</button>
                            </div>
                        </div>
                    </details>
                    
                    <h2 class="alaotsikko">L√∂ydetyt k√§tk√∂t</h2>
                    <div id="logSortControls" class="sort-controls">
                        <span>J√§rjest√§:</span>
                        <button data-sort="timestamp" class="sort-btn active">Ajan mukaan</button>
                        <button data-sort="municipality" class="sort-btn">Kunnan mukaan</button>
                    </div>
                    <ul id="foundCachesList"></ul>
                </div>
            </div>
        </div>
    </div>
    
    <template id="cacheTypeSelector">
        <select class="cache-type-selector">
            <option value="Tradi">Tradi</option>
            <option value="Multi">Multi</option>
            <option value="Mysti">Mysti</option>
            <option value="Letter">Letter</option>
            <option value="Wherigo">Wherigo</option>
            <option value="Event">Event</option>
            <option value="Muu">Muu</option>
        </select>
    </template>
    
    <div id="editCacheModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2>Muokkaa k√§tk√∂n tietoja</h2>
            <form id="editCacheForm">
                <input type="hidden" id="editSource">
                <input type="hidden" id="editMunIndex">
                <input type="hidden" id="editCacheIndex">

                <div class="form-row">
                    <div class="form-group">
                        <label for="editGcCode">GC-koodi:</label>
                        <input type="text" id="editGcCode" placeholder="GCXXXXX">
                    </div>
                    <div class="form-group">
                        <label for="editFp">FP-tiedot:</label>
                        <input type="text" id="editFp" placeholder="esim. 15 FP (7%)">
                    </div>
                </div>

                <div class="form-group">
                    <label for="editName">Nimi:</label>
                    <input type="text" id="editName" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="editType">Tyyppi:</label>
                        <input type="text" id="editType">
                    </div>
                    <div class="form-group">
                        <label for="editSize">Koko:</label>
                        <input type="text" id="editSize">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editDifficulty">Vaikeus (D):</label>
                        <input type="text" id="editDifficulty" placeholder="1.0 - 5.0">
                    </div>
                    <div class="form-group">
                        <label for="editTerrain">Maasto (T):</label>
                        <input type="text" id="editTerrain" placeholder="1.0 - 5.0">
                    </div>
                </div>

                <div class="form-group">
                    <label for="editCoords">Koordinaatit:</label>
                    <input type="text" id="editCoords" placeholder="N 62¬∞ 16.006 E 021¬∞ 25.444">
                </div>

                <div class="modal-actions">
                    <button type="submit" class="modal-save-btn">Tallenna</button>
                    <button type="button" class="modal-cancel-btn">Peruuta</button>
                </div>
            </form>
        </div>
    </div>
    
    <script type="module" src="script.js"></script>
</body>
</html>
